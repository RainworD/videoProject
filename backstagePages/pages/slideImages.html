<style type="text/css">
	.button_{
		display: inline-block!important;
		width: 49%;
		margin-top: 10px;
		height: 30px;
	    line-height: 30px;
	    padding: 0;
	}
</style>
<div class="admin_content_innerBox admin_ui_cont_bottomPadding">
	<div class="admin_scrollBox">
		<div class="admin_ui_header">
			<i class="fa fa-image fa-2x admin_ui_mainColor"></i>
			<span class="maintitle">轮播图设置</span>
		</div>
		<div id="slideImagesBox" class="admin_ui_cont">
			<div class="admin_ui_border admin_ui_cont_header admin_ui_cont_header_grey">
				轮播图管理
			</div>
			<div id="topSlideImagesBox" class="admin_ui_border admin_ui_cont" style="margin-bottom: 20px;">
				<div class="admin_ui_slideImageBox" >
					<div class="slideImageUpload">
						<p class="tip">
							<i class="fa fa-cloud-upload"></i>
							点击上传图片
						</p>
					</div>
					<textarea class="admin_ui_textarea" rows="2" placeholder="请输入链接地址"></textarea>
					<p>系统推送:<span></span><a href="#/pushSelect.html" class="admin_ui_button admin_ui_button_white" style="height: 30px;padding: 0;line-height: 30px;min-width: 80px;margin-left: 5px;">选择文章</a></p>
					<p>url:<input type="text" style="margin-top:10px;width:85%;height:30px;border:1px solid #ccc;margin-left:10px;" class="ui-input"></p>
					<div class="admin_ui_button admin_ui_button_green checkButton button_">
						确认
					</div>
					<div class="admin_ui_button admin_ui_button_red deleteButton button_">删除</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="admin_ui_cont_bottomFixed">
	<div class="admin_ui_button_group" style="float: right">
		<div class="admin_ui_button admin_ui_button_white" data-urlback>
			返回
		</div>
		<div id="saveSlideImagesButton" class="admin_ui_button admin_ui_button_green">
			保存
		</div>
	</div>
</div>
<script>
	var type_arr=[];
    $("#file").on("change", function(e){
        type_arr=[];
        var btn=document.getElementById("cancel");
        var file = e.target.files; //获取图片资源
        // console.log(file.length);
        for(var i=0; i< file.length; i++){
            var type=file[i] .type;
            type_arr.push(type);  
            // if (!file[i].type.match('image.*')) {
            //     return false;
            // }//只选取图片文件
            var reader = new FileReader();

            reader.readAsDataURL(file[i]); // 读取文件
              // 渲染文件
            reader.onload = function(arg) {
                var img='<div class="deliverImg_">'+
                            '<img src="' + arg.target.result + '" data-preview-src="" data-preview-group="1" class="commonImg">'+
                            '<img src="../source/img/remove.png" alt="" class="removeBtn">'+
                        '</div>'
            // var img = '<img class="preview" src="' + arg.target.result + '" alt="preview"/>';
                $(".deliverImg").prepend(img);
            }
        }
    });
    $("#upload").bind("click",function(){
        var photo_arr=[];
        if(type_arr.length){
            console.log("success");
            for(var i=0;i<type_arr.length;i++){
                $.when(getImgUrl(type_arr[i])).done(function(data){
                    console.log(data);
                    if(data.state==0){
                        var data=data.data;
                        OSSAccessKeyId=data.OSSAccessKeyId;
                        Signature=data.Signature;
                        callback=data.callback;
                        key=data.key;
                        policy=data.policy;
                    }
                    var picFileList = $("#file").get(0).files;
                    // var picFileList = $("#pic")[0].files;验证是否可行
                    var formData = new FormData();
                    for(var i=0; i< picFileList.length; i++){
                        formData.append("OSSAccessKeyId",OSSAccessKeyId);
                        formData.append("Signature",Signature);
                        formData.append("callback",callback);
                        formData.append("key",key);
                        formData.append("policy",policy);
                        formData.append("file" , picFileList[i]);
                        $.when(uploadImg(formData)).done(function(data){
                            alert("2222");
                            photo_arr.push(data.id);
                            var title;
                            var text=$("#textArea").val();
                            informed=[];
                            $.when(deliverActivity(title,text,photo_arr,informed)).done(function(data){
                                if(data.state==0){
                                    alert("发布成功！")
                                }
                            })
                        })
                    }
                    // formData.append('file', $('#file')[0].files[0]);
                })
            }
        }
    }) 
</script>






























